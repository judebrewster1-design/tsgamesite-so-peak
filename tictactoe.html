<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Tic Tac Toe</title>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; text-align: center; margin: 0; padding: 0; }
  h1 { margin-top: 20px; color: #333; }
  #usernameForm, #game { margin-top: 30px; }
  #board { display: grid; grid-template-columns: repeat(3, 100px); gap: 5px; justify-content: center; }
  .cell { width: 100px; height: 100px; background: #fff; display: flex; align-items: center; justify-content: center; font-size: 2em; cursor: pointer; border: 2px solid #333; }
  .cell:hover { background: #ddd; }
  #status { margin-top: 20px; font-weight: bold; }
</style>
</head>
<body>

<h1>Online Tic Tac Toe</h1>

<div id="usernameForm">
  <input type="text" id="username" placeholder="Enter username">
  <button id="startBtn">Start Game</button>
  <p id="usernameWarning" style="color:red;"></p>
</div>

<div id="game" style="display:none;">
  <div id="board"></div>
  <div id="status"></div>
</div>

<script>
const SERVER_URL = "https://spicy-hornets-agree.loca.lt";
let username = "";
let banned = false;
let board = ["", "", "", "", "", "", "", "", ""];
let xTurn = true;

// Load banned info from localStorage
if(localStorage.getItem("banned") === "true") {
  banned = true;
  alert("You are banned from playing due to inappropriate username.");
}

// Start game
document.getElementById("startBtn").onclick = async () => {
  username = document.getElementById("username").value.trim();
  if(!username) return;

  if(await checkBanned(username)) {
    banned = true;
    localStorage.setItem("banned", "true");
    document.getElementById("usernameWarning").innerText = "Username is banned!";
    return;
  }

  localStorage.setItem("banned", "false");
  document.getElementById("usernameForm").style.display = "none";
  document.getElementById("game").style.display = "block";
  initBoard();
}

// Check banned words from server
async function checkBanned(name) {
  try {
    const res = await fetch(`${SERVER_URL}/banned_words`);
    const bannedWords = await res.json();
    return bannedWords.some(word => name.toLowerCase().includes(word.toLowerCase()));
  } catch(e) {
    console.error("Error fetching banned words", e);
    return false;
  }
}

// Initialize board UI
function initBoard() {
  const boardEl = document.getElementById("board");
  boardEl.innerHTML = "";
  board.forEach((cell, idx) => {
    const div = document.createElement("div");
    div.classList.add("cell");
    div.dataset.index = idx;
    div.innerText = cell;
    div.onclick = cellClick;
    boardEl.appendChild(div);
  });
  updateStatus();
}

// Handle cell click
function cellClick(e) {
  const idx = e.target.dataset.index;
  if(board[idx] !== "" || banned) return;
  board[idx] = xTurn ? "X" : "O";
  xTurn = !xTurn;
  syncBoard();
  initBoard();
}

// Update status text
function updateStatus() {
  if(banned) {
    document.getElementById("status").innerText = "You are banned from playing.";
    return;
  }
  document.getElementById("status").innerText = xTurn ? "Your turn (X)" : "Opponent's turn (O)";
}

// Sync board with server
async function syncBoard() {
  try {
    await fetch(`${SERVER_URL}/update_board`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({username, board})
    });
  } catch(e) {
    console.error("Error syncing board", e);
  }
}

// Poll board from server
async function pollBoard() {
  try {
    const res = await fetch(`${SERVER_URL}/get_board?username=${encodeURIComponent(username)}`);
    const data = await res.json();
    board = data.board;
    xTurn = data.xTurn;
    initBoard();
  } catch(e) {}
  setTimeout(pollBoard, 1000);
}

pollBoard();
</script>

</body>
</html>
