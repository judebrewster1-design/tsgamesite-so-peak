<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Judeverse TicTacToe</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    margin: 0;
    padding: 0;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  #container {
    text-align: center;
    width: 100%;
    max-width: 400px;
  }
  h1 {
    margin-bottom: 10px;
    font-size: 2rem;
    color: #ffeb3b;
    text-shadow: 1px 1px 5px black;
  }
  #nameInput, #joinBtn {
    padding: 10px;
    margin: 5px 0;
    width: 80%;
    font-size: 1rem;
    border-radius: 5px;
    border: none;
  }
  #joinBtn {
    background: #ff5722;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
  }
  #joinBtn:hover {
    background: #e64a19;
  }
  #waitingRoom {
    margin-top: 20px;
    display: none;
  }
  #gameBoard {
    display: none;
    margin-top: 20px;
    grid-template-columns: repeat(3, 1fr);
    gap: 5px;
    display: grid;
  }
  .cell {
    background: #2196f3;
    width: 100px;
    height: 100px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2.5rem;
    cursor: pointer;
    border-radius: 10px;
    transition: transform 0.2s;
  }
  .cell:hover {
    transform: scale(1.1);
  }
  #status {
    margin-top: 15px;
    font-size: 1.2rem;
  }
  #bannedMsg {
    color: #ff1744;
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>
<div id="container">
  <h1>Judeverse TicTacToe</h1>
  <input type="text" id="nameInput" placeholder="Enter your name">
  <button id="joinBtn">Join Game</button>
  <div id="bannedMsg"></div>
  <div id="waitingRoom">Waiting for another player...</div>
  <div id="gameBoard"></div>
  <div id="status"></div>
</div>

<script>
const bannedWords = ["badword1","badword2","badword3","jude","nazi","hate"]; // add more
const joinBtn = document.getElementById('joinBtn');
const nameInput = document.getElementById('nameInput');
const bannedMsg = document.getElementById('bannedMsg');
const waitingRoom = document.getElementById('waitingRoom');
const gameBoard = document.getElementById('gameBoard');
const status = document.getElementById('status');

let playerName = "";
let playerSymbol = "";
let board = [
  ["","",""],
  ["","",""],
  ["","",""]
];
let ws;

function checkBanned(name){
  const lowered = name.toLowerCase();
  return bannedWords.some(word => lowered.includes(word));
}

function initBoard(){
  gameBoard.innerHTML = "";
  for(let y=0;y<3;y++){
    for(let x=0;x<3;x++){
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.x = x;
      cell.dataset.y = y;
      cell.addEventListener('click', makeMove);
      gameBoard.appendChild(cell);
    }
  }
}

function makeMove(e){
  if(ws && playerSymbol){
    const x = e.target.dataset.x;
    const y = e.target.dataset.y;
    if(board[y][x]===""){
      ws.send(JSON.stringify({action:"move",x:parseInt(x),y:parseInt(y)}));
    }
  }
}

function updateBoard(newBoard){
  board = newBoard;
  document.querySelectorAll('.cell').forEach(cell => {
    const x = cell.dataset.x;
    const y = cell.dataset.y;
    cell.textContent = board[y][x];
  });
}

function handleMessage(msg){
  const data = JSON.parse(msg.data);
  if(data.action==="waiting"){
    waitingRoom.style.display = "block";
    status.textContent = "Waiting for another player...";
  }
  else if(data.action==="start"){
    waitingRoom.style.display = "none";
    gameBoard.style.display = "grid";
    playerSymbol = data.symbol;
    status.textContent = `Game started! You are ${playerSymbol}`;
    updateBoard(data.board);
  }
  else if(data.action==="board"){
    updateBoard(data.board);
    if(data.last_move){
      status.textContent = `${data.last_move.symbol} moved at (${data.last_move.x+1},${data.last_move.y+1})`;
    }
  }
  else if(data.action==="win"){
    updateBoard(data.board);
    status.textContent = `Player ${data.winner} wins!`;
    playerSymbol = "";
  }
  else if(data.action==="draw"){
    status.textContent = "Draw!";
    playerSymbol = "";
  }
  else if(data.error){
    status.textContent = "Error: " + data.error;
  }
}

joinBtn.addEventListener('click', ()=>{
  const name = nameInput.value.trim();
  if(name===""){
    bannedMsg.textContent = "Enter a valid name!";
    return;
  }
  if(checkBanned(name)){
    bannedMsg.textContent = "Name contains banned words!";
    return;
  }
  bannedMsg.textContent = "";
  playerName = name;
  
  ws = new WebSocket("wss://young-wasps-attend.loca.lt/ws");
  ws.onopen = ()=>{ ws.send(JSON.stringify({action:"join",name:playerName})); };
  ws.onmessage = handleMessage;
  ws.onerror = (err)=>{ console.error(err); status.textContent="Connection error"; };
  ws.onclose = ()=>{ status.textContent="Connection closed"; };
  
  joinBtn.disabled = true;
  nameInput.disabled = true;
});

initBoard();
</script>
</body>
</html>
